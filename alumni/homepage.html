<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEXT STEP | Homepage</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <header class="navbar">
        <div class="logo-area">
            <div class="logo-circle">
                <img src="../logo/Blue%20%26%20Orange%20Circle%20Illustrative%20Education%20Logo.jpg" class="nav-logo" alt="Next Step logo" onerror="this.onerror=null;this.src='../logo/557536151_1257403522824074_2017646524872962832_n.png'">
            </div>
            <h3 class="brand">NEXT STEP</h3>
        </div>
        <nav class="main-nav">
            <a href="homepage.html" id="nav-home">Home</a>
            <a href="Information.html" id="nav-info">Information</a>
            <a href="profile.html" id="nav-profile">Profile</a>
            <a href="#about" id="nav-about">About</a>
            <a href="#site-contact" id="nav-contact">Contact</a>
        </nav>
        <div class="nav-actions">
            <a href="../login.html" class="nav-cta" id="nav-login">Login</a>
            <button id="nav-logout" class="nav-cta" style="display:none">Logout</button>
        </div>
    </header>

    <section class="hero">
        <video autoplay muted loop id="myVideo" class="bg-video">
            <source src="../video/9738c22044bba02e03a120fc8bcae46d.mp4" type="video/mp4">
        </video>
        <div class="overlay">
            <h1 id="hero-title">Welcome to Next Step</h1>
            <p id="hero-text">Next Step is a dedicated platform designed to help alumni connect, grow, and take the next step in their professional journey. Our mission is to bridge the gap between education and employment by providing graduates with access to job opportunities,
                career resources, and a supportive alumni network. Click and Fill up the Information Sheet.</p>
            <a id="hero-cta" href="Information.html" class="btn primary">Fill up</a>
        </div>
    </section>

    <section id="about" class="section-white">
        <h2 id="about-heading" class="section-heading">ABOUT US</h2>
        <div class="content-wrap">
            <p id="about-lead" class="lead">Welcome to <strong>NEXT STEP</strong>. Educational institutions struggle to track alumni due to manual or outdated record-keeping systems. NEXTSTEP provides a secure, web-based platform for managing alumni records, surveys, analytics, and engagement.</p>
            <div class="section-spacing">
                <h3 class="subheading">Specific Objectives</h3>
                <ol id="objectives-list" class="objectives">
                    <li>To develop a profile of the graduates.</li>
                    <li>To identify the employment status of graduates: Employed, Self-employed, Unemployed, Pursuing further studies, Freelancer.</li>
                    <li>To determine the career trajectories of graduates in relation to their program.</li>
                    <li>To provide a structured feedback mechanism for graduates using their student numbers.</li>
                    <li>To improve record management by organizing graduate data into a centralized system.</li>
                </ol>
            </div>
            <div class="section-spacing">
                <h3 class="subheading">Mission</h3>
                <p id="mission-text" class="lead">Next Step is committed to fostering lifelong connections between graduates and their alma mater by providing a dynamic platform for alumni engagement, career tracking, and professional growth. We support continuous learning, mentorship,
                    and data-driven improvements in education through meaningful alumni involvement.</p>
            </div>
            <div>
                <h3 class="subheading">Vision</h3>
                <p id="vision-text" class="lead">To be the leading digital hub that empowers alumni to thrive, inspire future generations, and shape institutional excellence through collaboration, innovation, and shared success.</p>
            </div>
        </div>
    </section>

    <footer id="site-contact">
        <div class="footer-content">
            <div>
                <h4>VISIT US ON</h4>
                <p>
                    <a href="https://www.facebook.com/profile.php?id=61584321894998" target="_blank" class="footer-icons">Facebook</a>
                    <a href="https://www.instagram.com/nextstep013?igsh=NTk2dXQ4a2F2OHh2" target="_blank" class="footer-icons">Instagram</a>
                </p>
            </div>
            <div>
                <h4>CONTACT INFORMATION</h4>
                <p>Phone: 09940816650<br>Email: nextstep.future986@gmail.com</p>
            </div>
            <div>
                <h4>CAMPUS ADDRESS</h4>
                <p>Km. 38, Sitio Gulod<br>Brgy. Pulong-Buhangin<br>Municipality of Sta. Maria, Bulacan</p>
            </div>
        </div>
    </footer>
    <script src="/supabase-client.js" defer></script>
    <script>
        // Dynamic content populated from JSON/Supabase (kept from original file)
        (async function() {
            const url = 'data/homepage.json';
            const fallback = {
                hero: {
                    title: 'Welcome to Next Step',
                    text: 'Next Step is a dedicated platform designed to help alumni connect, grow, and take the next step in their professional journey.',
                    ctaText: 'Fill up',
                    ctaHref: 'Information.html'
                },
                about: {
                    heading: 'ABOUT US',
                    lead: 'Welcome to Next Step. We believe that every student\'s journey doesn\'t end at graduationâ€”it evolves.',
                    objectives: [
                        'To develop a profile of the graduates.',
                        'To analyze employment outcomes and career trajectories.',
                        'To evaluate the alignment between acquired academic skills and job requirements.',
                        'To gather feedback on the effectiveness of institutional services and support.',
                        'To formulate evidence-based recommendations for academic and institutional improvement.'
                    ],
                    mission: 'Next Step is committed to fostering lifelong connections between graduates and their alma mater by providing a dynamic platform for alumni engagement, career tracking, and professional growth.',
                    vision: 'To be the leading digital hub that empowers alumni to thrive, inspire future generations, and shape institutional excellence through collaboration, innovation, and shared success.'
                }
            };

            function apply(data) {
                try {
                    const hTitle = document.getElementById('hero-title');
                    const hText = document.getElementById('hero-text');
                    const hCta = document.getElementById('hero-cta');
                    const aHeading = document.getElementById('about-heading');
                    const aLead = document.getElementById('about-lead');
                    const objList = document.getElementById('objectives-list');
                    const mission = document.getElementById('mission-text');
                    const vision = document.getElementById('vision-text');

                    if (hTitle && data.hero && data.hero.title) hTitle.textContent = data.hero.title;
                    if (hText && data.hero && data.hero.text) hText.textContent = data.hero.text;
                    if (hCta && data.hero) {
                        hCta.textContent = data.hero.ctaText || hCta.textContent;
                        if (data.hero.ctaHref) hCta.setAttribute('href', data.hero.ctaHref);
                    }

                    if (aHeading && data.about && data.about.heading) aHeading.textContent = data.about.heading;
                    if (aLead && data.about && data.about.lead) aLead.textContent = data.about.lead;
                    if (objList && Array.isArray(data.about && data.about.objectives)) {
                        objList.innerHTML = '';
                        data.about.objectives.forEach(item => {
                            const li = document.createElement('li');
                            li.textContent = item;
                            objList.appendChild(li);
                        });
                    }
                    if (mission && data.about && data.about.mission) mission.textContent = data.about.mission;
                    if (vision && data.about && data.about.vision) vision.textContent = data.about.vision;
                } catch (e) {
                    console.warn('apply homepage data failed', e);
                }
            }

            async function loadFromSupabase() {
                if (!window.supabase || typeof window.supabase.from !== 'function') return null;
                try {
                    const {
                        data,
                        error
                    } = await window.supabase.from('homepage').select('key, content');
                    if (error) {
                        console.warn('supabase fetch error', error);
                        return null;
                    }
                    const combined = {};
                    (data || []).forEach(r => {
                        try {
                            combined[r.key] = r.content;
                        } catch (e) {}
                    });
                    return combined;
                } catch (e) {
                    console.warn('supabase read failed', e);
                    return null;
                }
            }

            // Try Supabase first (if configured), fall back to local JSON, then embedded fallback
            try {
                const supa = await loadFromSupabase();
                if (supa) {
                    apply(supa);
                    return;
                }
            } catch (e) { /* ignore and fallback */ }

            fetch(url).then(r => {
                if (!r.ok) throw new Error('network');
                return r.json();
            }).then(data => apply(data)).catch(() => {
                console.info('Using fallback homepage data');
                apply(fallback);
            });
        })();

        // Session-aware navbar and hero CTA + robust video autoplay
        async function waitForSupabase(ms = 4000) {
            const start = Date.now();
            while (Date.now() - start < ms) {
                if (window.supabase && window.supabaseClientReady) return true;
                await new Promise(r => setTimeout(r, 120));
            }
            return false;
        }

        document.addEventListener('DOMContentLoaded', async() => {
            const email = (localStorage.getItem('currentUserEmail') || '').trim().toLowerCase();
            const loginLink = document.getElementById('nav-login');
            const logoutBtn = document.getElementById('nav-logout');
            const heroCta = document.getElementById('hero-cta');
            const vid = document.getElementById('myVideo');
            const aboutLink = document.getElementById('nav-about');
            const contactLink = document.getElementById('nav-contact');

            if (email) {
                if (loginLink) loginLink.style.display = 'none';
                if (logoutBtn) logoutBtn.style.display = 'inline-block';
            }

            // Decide CTA ('Go to Profile' vs 'Fill up') based on profile existence
            if (email && heroCta) {
                try {
                    const ready = await waitForSupabase();
                    if (ready) {
                        const {
                            data,
                            error
                        } = await window.supabase
                            .from('alumni_profiles')
                            .select('id')
                            .eq('email', email)
                            .limit(1);
                        if (!error && data && data.length) {
                            heroCta.textContent = 'Go to Profile';
                            heroCta.setAttribute('href', 'profile.html');
                        } else {
                            heroCta.textContent = 'Fill up';
                            heroCta.setAttribute('href', 'Information.html');
                        }
                    }
                } catch (e) {}
            }

            // Ensure background video plays after redirects/login
            if (vid) {
                vid.muted = true;
                const tryPlay = () => vid.play().catch(() => {
                    const resume = () => {
                        vid.play().catch(() => {});
                        document.removeEventListener('click', resume);
                    };
                    document.addEventListener('click', resume, {
                        once: true
                    });
                });
                tryPlay();
                vid.addEventListener('canplay', tryPlay, {
                    once: true
                });
                document.addEventListener('visibilitychange', () => {
                    if (!document.hidden) tryPlay();
                });
            }

            // Attach smooth scroll behavior (in case browser doesn't auto smooth)
            function smoothScroll(targetId) {
                const el = document.querySelector(targetId);
                if (!el) return;
                window.scrollTo({
                    top: el.offsetTop - 80,
                    behavior: 'smooth'
                });
            }
            if (aboutLink) {
                aboutLink.addEventListener('click', (e) => {
                    e.preventDefault();
                    smoothScroll('#about');
                });
            }
            if (contactLink) {
                contactLink.addEventListener('click', (e) => {
                    e.preventDefault();
                    smoothScroll('#site-contact');
                });
            }

            if (logoutBtn) {
                logoutBtn.addEventListener('click', () => {
                    localStorage.removeItem('currentUserEmail');
                    window.location.href = '../login.html';
                });
            }
        });
    </script>
</body>

</html>